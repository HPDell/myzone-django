{% extends "post_base.html" %}

{% block title %}
New Post
{% endblock %}

{% block pre_modules %}
{{ block.super }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vditor@3.8.12/dist/index.css" />
<script src="https://cdn.jsdelivr.net/npm/vditor@3.8.12/dist/index.min.js"></script>
<style>
    #post-content {
        display: none;
    }
    #vditor {
        height: 50vh;
    }
</style>
{% endblock %}

{% block main %}
<div class="container">
    <div class="row py-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb text-muted">
                <li class="breadcrumb-item"><a href="/" class="text-muted">Home</a></li>
                <li class="breadcrumb-item">Posts</li>
            </ol>
        </nav>
    </div>
    <h1>New Post</h1>
    <form action="/post/new/" method="post" class="py-3">
        {% csrf_token %}
        <div class="row">
            <div class="col-9">
                <div class="mb-3">
                    <label for="post-title" class="form-label"><h5>Title</h5></label>
                    <input name="title" id="post-title" class="form-control" type="text">
                </div>
                <div class="mb-3">
                    <div id="vditor"></div>
                    <textarea name="content" id="post-content" cols="40" rows="10"></textarea>
                </div>
                <div class="mb-3">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </div>
            <div class="col-3">
                <div class="mb-3">
                    <label class="form-label" for="post-cover"><h5>Cover</h5></label>
                    <input type="file" name="cover" class="form-control" name="cover" id="post-cover">
                </div>
                <div class="mb-3">
                    <label class="form-label" for="post-date"><h5>Date</h5></label>
                    <input type="date" name="date" class="form-control" name="date" id="post-date">
                </div>
                <div class="mb-3">
                    <label class="form-label" for="post-category"><h5>Category</h5></label>
                    <input type="text" name="category" class="form-control" list="category-list-options" id="post-category" placeholder="Select or create one">
                    <datalist name="category" id="category-list-options">
                        {% for item in categories %}
                        <option value="{{item.name}}"></option>
                        {% endfor %}
                    </datalist>
                </div>
                <div class="mb-3">
                    <h5>Tags</h5>
                    {% for item in tags %}
                    <div class="form-check form-check-inline">
                        <input type="checkbox" class="form-check-input" value="{{item.name}}" name="tags" id="post-tag-{{item.id}}">
                        <label class="form-check-label" for="post-tag-{{item.id}}">{{item.name}}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block post_modules %}
<script>
    const contentElement = document.getElementById("post");
    const vditor = new Vditor('vditor', {
        value: '',
        cache: {
            enabled: false
        },
        after() {
            vditor.clearCache()
            vditor.setValue(document.getElementById('post-content').value)
        },
        input(md) {
            document.getElementById('post-content').value = md
        }
    })
</script>
{% endblock %}
